<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1024" />
  <title>ì›ì£¼ì—¬ìê³ ë“±í•™êµ ì§„ë‹¬ë˜ìë£Œì‹¤</title>

  <style>
    body {
      margin: 0;
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #fff0f3;
    }

    /* ===== Header ===== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      border-bottom: 2px solid black;
    }
    .header h1 { margin: 0; font-size: 18px; }
    .nav-container { flex: 1; display: flex; justify-content: center; }
    .nav { display: flex; gap: 80px; font-size: 14px; }
    .nav a { text-decoration: none; color: black; }
    .nav a:hover { font-weight: bold; }
    .login {
      background-color: #fce4ec;
      padding: 5px 15px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
    }
    .wjg { text-decoration: none; color: black; padding: 10px 20px; }

    /* ===== Hero(Main) ===== */
    .main {
      position: relative;                 /* ë­í‚¹ ë°•ìŠ¤ë¥¼ ì˜¬ë¦¬ê¸° ìœ„í•¨ */
      background-image:
        linear-gradient(to bottom, #ffffff 25%, rgba(255, 255, 255, 0) 55%),
        url("ì›ì—¬ê³ ìš´ë™ì¥.jpg");
      background-size: 100% 100%;
      background-position: center bottom;
      background-repeat: no-repeat;
      margin: 20px;
      padding: 30px 30px 40px;
      border-radius: 20px;
      height: 600px;
      color: black;
    }
    .main h2 { font-size: 36px; margin: 0 0 10px 0; }
    .main p { font-size: 14px; line-height: 1.8; margin: 6px 0 0 0; }

    /* ë©”ì¸ ë²„íŠ¼ë“¤ */
    .hero-buttons { display: flex; gap: 30px; margin-top: 24px; }
    .hero-btn {
      width: 220px; height: 60px; line-height: 60px;
      background-color: pink; text-align: center; border-radius: 40px;
    }
    .hero-btn a { display: block; width:100%; height:100%; text-decoration:none; color:black; font-size:18px; }

    /* ===== Floating Ranking Box ===== */
    .ranking-float {
      position: absolute;
      top: 120px;                 /* í•„ìš”í•˜ë©´ ë¯¸ì„¸ ì¡°ì • */
      right: 40px;                /* í•„ìš”í•˜ë©´ ë¯¸ì„¸ ì¡°ì • */
      width: 360px;
      background: rgba(255, 221, 227, 0.9);
      backdrop-filter: blur(6px);
      border: 2px solid #f9aebe;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,.08);
      padding: 18px 18px 14px;
      z-index: 2;
    }
    .ranking-header {
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin: 0 0 10px 0;
    }
    .see-all {
      background:#ffd2db; border:1px solid #f9aebe; color:#5b3b3b;
      padding:6px 10px; border-radius:8px; font-size:13px; text-decoration:none;
    }
    .see-all:hover { background:#fff3f5; }
    .ranking-list { display:flex; flex-direction:column; gap:10px; max-height:380px; overflow:auto; }
    .rank-item {
      display:flex; align-items:center; justify-content:space-between;
      background:#fff; border:1px solid #f9aebe; border-radius:10px; padding:10px 12px;
      box-shadow:0 2px 5px rgba(0,0,0,.05);
    }
    .rank-left { display:flex; align-items:center; gap:10px; }
    .rank-medal {
      width:26px; height:26px; display:flex; align-items:center; justify-content:center;
      border-radius:50%; background:#ffe6ec; border:1px solid #f9aebe; font-weight:bold;
    }
    .rank-name { font-weight:600; color:#333; }
    .rank-meta { font-size:12px; color:#888; }
    .rank-score-badge {
      font-size:13px; color:#5b3b3b; background:#fff8fb; border:1px solid #f9aebe;
      padding:4px 8px; border-radius:8px;
    }
  </style>
</head>

<body>
  <!-- ===== Header ===== -->
  <div class="header">
    <a href="index.html" class="wjg"><b>ì›ì£¼ì—¬ìê³ ë“±í•™êµ</b></a>
    <div class="nav-container">
      <div class="nav">
        <a href="posts.html">ê²Œì‹œíŒ</a>
        <a href="notice.html">ê³µì§€ì‚¬í•­</a>
        <a href="inquiry.html">ë¬¸ì˜í•˜ê¸°</a>
      </div>
    </div>
    <div class="login">ë¡œê·¸ì¸</div>
  </div>

  <!-- ===== Hero(Main) ===== -->
  <div class="main">
    <div style="font-size:20px;">ì›ì£¼ì—¬ìê³ ë“±í•™êµ</div>
    <h2>í•™ìŠµìƒë‹´ë¶€</h2>
    <p>ì´ê³³ì€ ì›ì£¼ì—¬ìê³ ë“±í•™êµ í•™ìŠµìƒë‹´ë¶€ì˜ ì›¹ì‚¬ì´íŠ¸ ì…ë‹ˆë‹¤.</p>

    <div class="hero-buttons">
      <div class="hero-btn"><a href="login.html">ë¡œê·¸ì¸</a></div>
      <div class="hero-btn"><a href="write-post.html">ê¸€ ì‘ì„±í•˜ëŸ¬ ê°€ê¸°</a></div>
    </div>

    <!-- ğŸ”¥ íˆì–´ë¡œ ìš°ì¸¡ ë–  ìˆëŠ” ë­í‚¹ ë°•ìŠ¤ -->
    <div class="ranking-float">
      <div class="ranking-header">
        <h3 style="margin:0; color:#5b3b3b;">ì´ë²ˆ ë‹¬ TOP 5</h3>

        <!-- âœ… ê´€ë¦¬ì ì „ìš© ë²„íŠ¼ (ê¸°ë³¸ ìˆ¨ê¹€) -->
        <div style="display:flex; align-items:center; gap:6px;">
          <a id="adminHotBtn"
             href="manage-hot.html"
             class="see-all"
             style="display:none;">ğŸ”¥ ì—´í˜ˆë©¤ë²„ ê´€ë¦¬</a>
          <a href="ranking.html" class="see-all">ì „ì²´ ë­í‚¹ ë³´ê¸° â†’</a>
        </div>
      </div>
      <div id="rankingList" class="ranking-list"></div>
    </div>
  </div>

  <!-- ===== ë¡œê·¸ì¸ ë²„íŠ¼(ìš°ìƒë‹¨) + ê´€ë¦¬ì ë²„íŠ¼ í‘œì‹œ ===== -->
  <script type="module">
    document.addEventListener("DOMContentLoaded", () => {
      const userStr = localStorage.getItem("user");
      const loginDiv = document.querySelector(".login");
      const adminHotBtn = document.getElementById("adminHotBtn");

      if (userStr) {
        const user = JSON.parse(userStr);
        loginDiv.textContent = `${user.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤`;
        loginDiv.style.fontWeight = "bold";
        loginDiv.style.cursor = "default";
        loginDiv.addEventListener("click", () => {
          if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem("user");
            location.reload();
          }
        });

        // âœ… ê´€ë¦¬ìë§Œ ì—´í˜ˆë©¤ë²„ ê´€ë¦¬ ë²„íŠ¼ ë³´ì´ê¸°
        if (user.role === "admin" && adminHotBtn) {
          adminHotBtn.style.display = "inline-block";
        }
      } else {
        loginDiv.textContent = "ë¡œê·¸ì¸";
        loginDiv.style.cursor = "pointer";
        loginDiv.addEventListener("click", () => {
          location.href = "login.html";
        });
      }
    });
  </script>

  <!-- ===== ë­í‚¹ ìŠ¤í¬ë¦½íŠ¸ (Firestore users.score ê¸°ì¤€ TOP5) ===== -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCrxJuOjHGdttC2gfwfjqsvAjHicEav6BA",
      authDomain: "wjgh-learningdataroom.firebaseapp.com",
      projectId: "wjgh-learningdataroom",
      storageBucket: "wjgh-learningdataroom.firebasestorage.app",
      messagingSenderId: "284248567704",
      appId: "1:284248567704:web:88e70e08666e13ff80c5ed"
    };

    const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
    const auth = getAuth(app);
    signInAnonymously(auth).catch(() => {});
    const db = getFirestore(app);

    const listEl = document.getElementById("rankingList");

    // ì ìˆ˜ â†’ ì´ëª¨ì§€
    function scoreEmoji(score){
      if (score >= 20) return "ğŸ”¥";
      if (score >= 10) return "ğŸŒŸ";
      if (score >= 5)  return "ğŸ‘";
      return "";
    }
    // ìˆœìœ„ â†’ ë©”ë‹¬
    function rankMedal(n){
      if (n===1) return "ğŸ¥‡";
      if (n===2) return "ğŸ¥ˆ";
      if (n===3) return "ğŸ¥‰";
      return n; // 4,5ìœ„ëŠ” ìˆ«ì
    }

    function render(items){
      listEl.innerHTML = "";
      if (!items.length){
        // ë°ì´í„° ì—†ì„ ë•Œ, ìƒ˜í”Œ 3ê°œ
        items = [
          { nickname:"ìƒ˜í”Œ1", score:14 }, { nickname:"ìƒ˜í”Œ2", score:9 }, { nickname:"ìƒ˜í”Œ3", score:4 }
        ];
      }
      items.forEach((u, idx) => {
        const medal = rankMedal(idx+1);
        const badge = scoreEmoji(u.score||0);
        const name  = u.nickname || u.name || "ì´ë¦„ì—†ìŒ";
        const grade = u.grade || "";

        const row = document.createElement("div");
        row.className = "rank-item";
        row.innerHTML = `
          <div class="rank-left">
            <div class="rank-medal">${medal}</div>
            <div>
              <div class="rank-name">${name} ${badge}</div>
              <div class="rank-meta">${grade}</div>
            </div>
          </div>
          <div class="rank-score-badge">${u.score ?? 0} ì </div>
        `;
        listEl.appendChild(row);
      });
    }

    (async () => {
      try{
        const qy = query(collection(db, "users"), orderBy("score","desc"), limit(5));
        const snap = await getDocs(qy);
        const rows = [];
        snap.forEach(d => rows.push(d.data()));
        render(rows);
      }catch(e){
        console.warn("ë­í‚¹ ì¡°íšŒ ì‹¤íŒ¨(ìƒ˜í”Œë¡œ ëŒ€ì²´):", e);
        render([]);
      }
    })();
  </script>
</body>
</html>
